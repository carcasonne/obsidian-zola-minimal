{% extends "base.html" %}

{% block title %}layer:00/ego{% endblock title %}

{% block content %}
{% set all_sections = get_section(path="_index.md") %}
{% set all_pages = [] %}
{% for section_path in all_sections.subsections %}
    {% set section = get_section(path=section_path) %}
    {% set_global all_pages = all_pages | concat(with=section.pages) %}
{% endfor %}

<style>
    .irc-container {
  max-width: 1000px;
  margin: 0 auto;
  padding: 2rem;
  min-height: calc(100vh - 4rem);
}

.irc-header {
  font-family: 'courier new', monospace;
  font-size: 0.75rem;
  color: var(--wired-green);
  line-height: 1.4;
  margin-bottom: 1.5rem;
  text-align: center;
}

.irc-messages {
  font-family: 'courier new', monospace;
  font-size: 0.85rem;
  line-height: 1.8;
}

.system-message,
.activity-message,
.channel-info,
.input-line {
  display: flex;
  gap: 0.5rem;
  margin: 0.25rem 0;
  align-items: baseline;
}

.timestamp {
  color: var(--text-muted);
  min-width: 50px;
  font-size: 0.75rem;
}

.user {
  color: var(--wired-green);
  min-width: 80px;
}

.user.prompt {
  color: var(--accent-primary);
}

.text {
  color: var(--text-primary);
}

.action {
  color: var(--accent-tertiary);
}

.page-link,
.channel-link {
  color: var(--text-primary);
  text-decoration: none;
  position: relative;
}

.page-link:hover,
.channel-link:hover {
  color: var(--accent-primary);
  text-shadow: 0 0 4px var(--accent-primary);
}

.meta,
.channel-meta {
  color: var(--text-muted);
  font-size: 0.8rem;
}

.divider {
  color: var(--border-color);
  margin: 0.75rem 0;
  font-size: 0.75rem;
}

.input-line {
  margin-top: 1.5rem;
}

.cursor {
  color: var(--wired-green);
  animation: cursor-blink 1.5s infinite;
}

@media (max-width: 768px) {
  .irc-container {
    padding: 1rem;
  }
  
  .irc-messages {
    font-size: 0.75rem;
  }
  
  .timestamp {
    display: none;
  }
}
</style>

<div class="irc-container">
    <pre class="irc-header">
═══════════════════════════════════════════════════════════════════════════════
  WELCOME TO #EGO ON WIRED.NET
  {{ all_pages | length }} users online | topic: personal archive | {{ now() | date(format="%Y.%m.%d") }}
═══════════════════════════════════════════════════════════════════════════════
    </pre>

    <div class="irc-messages">
        <div class="system-message">
            <span class="timestamp">[{{ now() | date(format="%H:%M") }}]</span>
            <span class="user">&lt;system&gt;</span>
            <span class="text">connection established. welcome back.</span>
        </div>
        
        <div class="system-message">
            <span class="timestamp">[{{ now() | date(format="%H:%M") }}]</span>
            <span class="user">&lt;system&gt;</span>
            <span class="text">recent activity:</span>
        </div>
        
        <div class="divider">─────────────────────────────────────────────────────────────</div>
        
        {% for page in all_pages | sort(attribute="updated") | reverse | slice(end=8) %}
        <div class="activity-message">
            <span class="timestamp">[{{ page.updated | date(format="%H:%M") }}]</span>
            <span class="action">*</span>
            <a href="{{ page.permalink }}" class="page-link">{{ page.title | lower }}</a>
            <span class="meta">posted</span>
        </div>
        {% endfor %}
        
        <div class="divider">─────────────────────────────────────────────────────────────</div>
        
        <div class="system-message">
            <span class="timestamp">[{{ now() | date(format="%H:%M") }}]</span>
            <span class="user">&lt;system&gt;</span>
            <span class="text">available channels:</span>
        </div>
        
        {% for section_path in all_sections.subsections %}
            {% set section = get_section(path=section_path) %}
            {% set word_count = 0 %}
            {% for page in section.pages %}
                {% set_global word_count = word_count + page.word_count %}
            {% endfor %}
            <div class="channel-info">
                <span class="timestamp">[{{ now() | date(format="%H:%M") }}]</span>
                <span class="user">&lt;system&gt;</span>
                <a href="{{ section.permalink }}" class="channel-link">#{{ section.title | lower }}</a>
                <span class="channel-meta">[{{ section.pages | length }} messages, {{ word_count / 1000 | round(precision=1) }}k words]</span>
            </div>
        {% endfor %}
        
        <div class="divider">─────────────────────────────────────────────────────────────</div>
        
        <div class="system-message">
            <span class="timestamp">[{{ now() | date(format="%H:%M") }}]</span>
            <span class="user">&lt;system&gt;</span>
            <span class="text">type /join &lt;channel&gt; to browse</span>
        </div>
        
        <div class="system-message">
            <span class="timestamp">[{{ now() | date(format="%H:%M") }}]</span>
            <span class="user">&lt;system&gt;</span>
            <span class="text">type /read &lt;message&gt; to view</span>
        </div>
        
        <div class="input-line">
            <span class="timestamp">[{{ now() | date(format="%H:%M") }}]</span>
            <span class="user prompt">&lt;you&gt;</span>
            <span class="cursor">█</span>
        </div>
    </div>
</div>
{% endblock content %}