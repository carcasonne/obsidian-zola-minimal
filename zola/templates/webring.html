{% extends "base.html" %}

{% block title %}{{ section.title }}{% endblock title %}

{% block extra_head %}
<link rel="stylesheet" href="/css/page-specific/webring.css">
{% endblock extra_head %}

{% block content %}
{% set sites = load_data(path="content/lainring/lainring.json") %}

<div class="content-wrapper">
    <section class="section">
        <div class="section-header">
            <h1>{{ section.title }}</h1>
            <div class="layer-indicator">{{ section.title }}.nodes â€” {{ sites | length }} connected</div>
        </div>

        {% if section.content %}
        <div class="prose">
            {{ section.content | safe }}
        </div>
        {% endif %}

        <div class="webring-grid">
            {% for site in sites %}
            <div class="node-entry" {% if site.url %} data-url="{{ site.url }}" {% endif %}>
                <img src="/images/banner/{{ site.img }}" 
                     alt="Banner for {{ site.title }}"
                     class="banner-gif">
                <div class="node-info">
                    <div class="node-title">{{ site.title }}</div>
                    <div class="protocol-links">
                        {% if site.url %}
                        <a href="{{ site.url }}" class="protocol-link">http</a>
                        {% endif %}
                        {% if site.tor %}
                        <a href="{{ site.tor }}" class="protocol-link">tor</a>
                        {% endif %}
                        {% if site.i2p %}
                        <a href="{{ site.i2p }}" class="protocol-link">i2p</a>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="webring-footer">
            <button class="action-btn" onclick="randomNode()">random_node()</button>
            <div class="peer-count">{{ sites | length }} peers</div>
        </div>
    </section>
</div>

<script>
function randomNode() {
    const entries = document.querySelectorAll('.node-entry');
    const randomEntry = entries[Math.floor(Math.random() * entries.length)];
    window.open(randomEntry.dataset.url, '_blank');
}

document.querySelectorAll('.node-entry').forEach(entry => {
    entry.addEventListener('click', (e) => {
        if (!e.target.closest('.protocol-links')) {
            window.location.href = entry.dataset.url;
        }
    });
});
</script>
{% endblock content %}