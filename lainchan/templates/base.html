{% set docs_section = get_section(path="_index.md") %}
{% set layer_num = 0 %}
{% set current_section = "" %}

{% if page %}
    {% set current_section = page.components | first %}
    {% set counter = 0 %}
    {% for subsection_path in docs_section.subsections | sort %}
        {% set subsection = get_section(path=subsection_path) %}
        {% if subsection.pages | length > 0 %}
            {% set_global counter = counter + 1 %}
            {% if current_section in subsection_path %}
                {% set_global layer_num = counter %}
                {% break %}
            {% endif %}
        {% endif %}
    {% endfor %}
    {# webring special case #}
    {% if current_section == "webring" %}
        {% set_global layer_num = counter + 1 %}
    {% endif %}
{% elif section and section.title != "Home" %}
    {% set current_section = section.components | first %}
    {% set counter = 0 %}
    {% for subsection_path in docs_section.subsections | sort %}
        {% set subsection = get_section(path=subsection_path) %}
        {% if subsection.pages | length > 0 %}
            {% set_global counter = counter + 1 %}
            {% if subsection.permalink == section.permalink %}
                {% set_global layer_num = counter %}
                {% break %}
            {% endif %}
        {% endif %}
    {% endfor %}
    {# webring special case #}
    {% if section.components | first == "webring" %}
        {% set_global layer_num = counter + 1 %}
    {% endif %}
{% endif %}

{% if layer_num < 10 %}
    {% set layer_display = "0" ~ layer_num %}
{% else %}
    {% set layer_display = layer_num %}
{% endif %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="dark">
    <title>
        {% block title %}
        {% if page %}
        {{ config.title | lower }}/{{ page.title | lower | slugify }}
        {% elif section and section.title != "home" %}
        {{ config.title | lower }}/layer:{{ layer_display }}/{{ section.title | lower }}
        {% else %}
        {{ config.title | lower }}/layer:00/ego
        {% endif %}
        {% endblock title %}
    </title>
    <link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="/color-scheme.css">
    {% block extra_head %}{% endblock extra_head %}
</head>

<body>
    <div class="page-wrapper">
        {% include "components/navigation.html" %}
        <div class="container">
            <div class="id-bar">
                {% if page %}
                layer:00/ego → layer:{{ layer_display }}/{{ current_section }} → {{ page.title | lower }}
                {% elif section and section.title != "home" %}
                layer:00/ego → layer:{{ layer_display }}/{{ section.title | lower }}
                {% else %}
                layer:00/ego
                {% endif %}
            </div>
            <main class="main">
                {% block content %}{% endblock content %}
            </main>
        </div>
    </div>
    
    <script src="/js/main.js"></script>
    {% block extra_js %}{% endblock extra_js %}
</body>

</html>